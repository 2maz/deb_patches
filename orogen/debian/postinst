#!/bin/sh
# postinst script for orogen to make ruby1.9.1 the default ruby version
#
# see: dh_installdeb(1)

set -e

# summary of how this script can be called:
# * <postinst> `configure' <most-recently-configured-version>
# * <old-postinst> `abort-upgrade' <new version>
# * <conflictor's-postinst> `abort-remove' `in-favour' <package>
# <new-version>
# * <postinst> `abort-remove'
# * <deconfigured's-postinst> `abort-deconfigure' `in-favour'
# <failed-install-package> <version> `removing'
# <conflicting-package> <version>
# for details, see http://www.debian.org/doc/debian-policy/ or
# the debian-policy package

if [ "$1" = "configure" ]
then
    RUBYVER=1.9.1
    update-alternatives \
      --install /usr/bin/gem gem /usr/bin/gem${RUBYVER} 181 \
      --slave /etc/bash_completion.d/gem bash_completion_gem /etc/bash_completion.d/gem1.9.1

    update-alternatives \
      --install /usr/bin/ruby ruby /usr/bin/ruby${RUBYVER} 51 \
      --slave /usr/bin/erb erb /usr/bin/erb${RUBYVER} \
      --slave /usr/bin/testrb testrb /usr/bin/testrb${RUBYVER} \
      --slave /usr/bin/irb irb /usr/bin/irb${RUBYVER} \
      --slave /usr/bin/rdoc rdoc /usr/bin/rdoc${RUBYVER} \
      --slave /usr/bin/ri ri /usr/bin/ri${RUBYVER}

    # Set a symlink for Rock -- just for testing now, will later go into base/types
    RUBY_EXECUTABLE=/usr/bin/ruby${RUBY_VER}
    ROCK_BINDIR=/opt/rock/bin

    if [ ! -d ${ROCK_BINDIR} ]; then mkdir -p ${ROCK_BINDIR}; fi
    if [ ! -e ${ROCK_BINDIR}/ruby ]; then ln -s ${RUBY_EXECUTABLE} ${ROCK_BINDIR}/ruby; fi
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0

